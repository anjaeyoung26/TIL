## 클래스와 구조체 중에서 선택하기

클래스와 구조체 모두 앱에서 데이터를 저장하고 동작을 모델링하는 데 좋은 선택이지만, 둘의 유사성으로 인해 둘 중 하나를 선택하기 어려울 수 있다. 공식 문서 [Choosing Between Structures and Classes](https://developer.apple.com/documentation/swift/choosing-between-structures-and-classes)는 앱에서 새 데이터 타입을 추가할 때 클래스와 구조체 중 적절히 선택하기 위해 고려하는 몇 가지 권장 사항을 가이드한다.

&nbsp;
### 기본적으로 구조체를 선택

Swift의 구조체는 다른 프로그래밍 언어의 클래스와 같은 기능이 포함되어 있다. 구조체는 저장 프로퍼티, 연산 프로퍼티 및 메서드가 포함될 수 있으며 프로토콜을 채택할 수 있다. Swift의 표준 라이브러리 *Foundation*도 마찬가지로 `Int`, `String`, `Array` 등 많은 타입에 대해 구조체를 사용하고 있다. 또한 구조체는 클래스와 달리 값 타입이기 때문에 구조체애 대한 로컬 변경사항을 의도적으로 전달하지 않는 한 앱의 나머지 부분이 표시되지 않는 흐름의 일부이다. 예를 들어, 함수의 매개변수로 전달된 구조체의 인스턴스가 있을 때 함수 내에서 인스턴스의 값이 변경돼도 의도적으로 전달하지 않는 한 원본 변수의 값은 유지된다. 또한 값 타입은 메모리의 스택 영역을 사용함으로써 클래스와 같은 참조 타입이 메모리의 힙 영역을 사용하는 것보다 성능 상의 이점이 있다.

&nbsp;
### Objective-C 상호 운용성이 필요할 때 클래스 사용

데이터를 처리해야 하는 Objective-C API를 사용하거나 데이터 모델을 Objective-C 프레임워크에 정의된 기존 클래스 계층에 맞춰야 하는 경우 클래스 및 클래스 상속을 사용하여 데이터를 모델링 해야한다. 예를 들어, 많은 Objective-C 프레임워크는 하위 클래스로 예샹되는 클래스를 노출한다.

&nbsp;
### ID를 제어해야 할 때 클래스 사용

Swift의 클래스는 참조 타입이기 때문에 기본적으로 제공되는 ID 개념이 있다. 이는 두 개의 서로 다른 클래스 인스턴스가 각각의 저장된 프로퍼티에 대해 동일한 값을 가질 때 ID 연산자(`===`)에 의해 둘을 구분할 수 있다. 또한 앱에서 클래스 인스턴스를 공유할 때, 해당 인스턴스에 대한 변경사항이 그 인스턴스를 참조하는 모든 곳에서 변경된다. 이러한 동일성의 종류를 가진 인스턴스가 필요하다면 클래스를 사용하는 것이 적절하다. 하지만 클래스 인스턴스를 앱 전체에서 공유하면 [Race Condition](../OS/process-synchronization.md/#race-condition)과 같은 논리적 에러가 발생할 가능성이 높기 때문에 주의 깊게 다뤄야 한다.

&nbsp;
### ID를 제어하지 않을 때 구조체 사용

```swift
struct PenPalRecord {
  let myID: Int
  var myNickname: String
  var recommendedPenPalID: Int
}

var meRecord = try JSONDecoder().decode(PenPalRecord.self, from: jsonResponse)
```

제어하지 않는 ID를 가진 엔티티를 모델링할 때 구조체를 사용한다. 예를 들어, 원격 데이터베이스를 참조하는 앱에서 인스턴스의 ID는 외부 엔티티가 소유하고 변수(`myRecord`)로 통신할 수 있다. *'외부 엔티티가 인스턴스의 ID를 소유한다'* 의 의미는 `PenParRecord` 구조체의 `myID`가 상수로 선언되어 있어 서버에서 전달된 ID를 저장할 뿐, 로컬에서 변경할 수 없음을 의미한다. 반면에 `myNickname`과 `recommendedPenPalID`는 변수로 정의되어 있으므로, 값을 변경하고 서버에 Request를 보내서 데이터베이스의 내용을 변경할 수 있다.

&nbsp;
### 모델의 상속이나 공유를 위해 구조체 + 프로토콜 사용

기본적으로 구조체는 상속을 지원하지 않지만 프로토콜을 채택해서 클래스의 상속과 같은 계층 구조를 만들 수 있다. 클래스를 통해 상속 구조를 만들면 클래스 간의 상속만 가능하기 때문에 범위가 제한되지만, 프로토콜은 클래스, 구조체, 열거형 모두 채택할 수 있다. 따라서 상속 관계를 처음부터 구축하는 경우 프로토콜 상속을 선호한다. 데이터 모델링을 할 때, 먼저 프로토콜 상속을 통해 데이터 타입의 계층 구조를 설계하고 구조체가 해당 프로토콜을 채택하도록 구현한다.