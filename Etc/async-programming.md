## 비동기 프로그래밍

우리가 사용하는 프로그래밍 언어는 왼쪽에서 오른쪽으로, 위에서 아래로 실행된다. 만약 Task A, B, C를 차례대로 실행시키면 A가 완료된 후에야 B를, B가 완료된 후에야 C를 실행한다. 이는 일반적으로 사용되는 동기 프로그래밍의 동작 과정이다. 만약 Task A는 1초 소요되고, B는 10초 소요된다면 C는 11초를 기다리고 나서야 실행된다. 이제 Task A, B, C의 동작을 아래와 같이 생각해보자.

- *Task A* : 이미지 뷰를 화면에 추가한다.
- *Task B* : 서버에서 이미지를 다운로드한다.
- *Task C* : 다운로드한 이미지를 이미지 뷰에 나타낸다.

*동기적 프로그래밍*에서는 서버에서 이미지를 다운로드 받는 동안 사용자 인터페이스의 이벤트를 받을 수 없다. 즉, *UI Frozen* 상태가 되어 사용자에게 애플리케이션에 대한 나쁜 인상을 준다. 이러한 맥락에서 *비동기 프로그래밍*의 필요성이 대두된다. *비동기적 프로그래밍*은 서버에서 이미지를 다운로드 받는 동안, 사용자 인터페이스의 이벤트를 받을 수 있도록 한다. 동기적/비동기적인 방식의 차이점을 코드로 살펴보자.

```swift
let taskA = {
  print("taskA is done")
}

let taskB = {
  var i: Int = 0
  while i < 5 {
    sleep(1)
    i += 1
    print(".", terminator: " ")
  }
  print("taskB is done")
}

let taskC = {
  print("taskC is done")
}
```

`taskA`와 `taskC`는 단순히 문자열을 출력하는 동작이며, `taskB`는 5초가 소요되는 동작이다. *동기적 프로그래밍*에서는 세 개의 Task를 아래와 같이 실행한다.

```swift
taskA()
taskB()
taskC()
```

그러면 `taskB`가 끝나고 나서야 `taskC`가 시작할 것이다. 결과는 아래와 같다.

```
taskA is done
.....taskB is done
taskC is done
```

이제 세 개의 Task를 비동기적으로 실행해보자. Swift에서는 비동기적인 동작을 지원하기 위한 여러 API가 있는데 추후에 살펴보자.

```swift
taskA()
DispatchQueue.global().async { taskB() }
taskC()
```

*동기적 프로그래밍*과 다르게 `DispatchQueue.global().async`를 통해 `taskB`를 실행한다. 결과는 아래와 같다.

```
taskA is done
taskC is done
.....taskB is done
```

`taskC`는 `taskB`가 끝나기를 기다리지 않고 실행한다. 이러한 동작은 [멀티 스레딩](../OS/process-thread.md/#멀티-쓰레딩)을 통해 구현된다. 위 코드에서 `taskA`와 `taskB`를 실행시키는 스레드와 별개로 `taskB`는 `DispatchQueue.global().async`를 통해 다른 스레드에서 실행시킨다. 이는 둘 이상의 스레드가 '동시'에 작업을 수행하는 멀티 스레딩이라고 하는데, 컴퓨터 입장에서 '동시'는 두 가지로 해석된다.

&nbsp;
## 동시성 vs 병렬성

### 동시성 프로그래밍

<p align="center">
<img src="https://user-images.githubusercontent.com/61190690/183659677-c0a61ef2-2e2a-480a-91c9-468c4cc70a9e.png" width="600">
</p>

일반적으로 '싱글 코어' 컴퓨터는 한 번에 하나의 작업을 수행한다. 또한 여러 개의 스레드가 있어도, 한 번에 하나의 스레드에서만 작업을 수행할 수 있다. 하지만 싱글 코어 컴퓨터에서도 동시에 여러 프로그램이 실행되는 것처럼 보인다. 이는 ***동시성 프로그래밍***을 통해 싱글 코어에서 멀티 스레드를 동작시킨 것이다. 육안으로는 동시에 여러 개의 스레드에서 작업을 수행하는 것처럼 보이지만, 실제로는 스레드를 번갈아 가면서 한 번에 하나의 작업을 수행한다. **동시성 프로그래밍**은 싱글 코어 뿐만 아니라, 멀티 코어 환경에서도 사용할 수 있다.

### 병렬성 프로그래밍

<p align="center">
<img src="https://user-images.githubusercontent.com/61190690/183659693-58fabc4e-ffaa-4afb-acd4-eb1ac4e8fd5a.png" width="600">
</p>

*병렬성 프로그래밍*은 *동시성 프로그래밍*과 다르게 실제로 여러 개의 스레드가 동시에 실행된다. *동시성 프로그래밍*은 지속적인 문맥 교환(Context Switching)을 통해 논리적인 관점에서 멀티 스레드를 구현했지만, *병렬성 프로그래밍*은 실제로 여러 개의 스레드가 동시에 작업을 실행하여 물리적인 관점에서 멀티 스레드를 구현한다. *병렬성 프로그래밍*은 멀티 스레딩과 더불어 물리적인 지원(멀티 코어)가 있어야 구현이 가능하며, 멀티 코어에서 멀티 스레드를 동작시키는 방식이다.

> 동시성과 병렬성은 별개의 개념이 아니다. 동시성은 병렬성을 만족하기 위한 필요 조건으로, 병렬성을 만족한다는 것은 동시성을 만족한다는 의미이다.

